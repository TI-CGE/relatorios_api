name: Deploy (main)

on:
  push:
    branches: [main]

env:
  COMPOSE_DIR: /srv/tomcat
  APP_PATH: /srv/apps/tc3
  SERVICE_NAME: relatorios-api

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v4

      - name: Atualizar c√≥digo no servidor
        run: |
          mkdir -p "${{ env.APP_PATH }}"
          rsync -a --delete --exclude '.git' ./ "${{ env.APP_PATH }}/"

      - name: Build e subir via compose geral
        run: |
          cd "${{ env.COMPOSE_DIR }}"
          docker compose build "${{ env.SERVICE_NAME }}"
          docker compose up -d "${{ env.SERVICE_NAME }}"
